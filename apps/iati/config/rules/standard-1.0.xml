<?xml version="1.0" encoding="UTF-8"?>
<ruleset name="standard" root="iati-activity" xml:lang="en" version="1.0">
    <description>
        <div>
            Rules which validate an Activity against the <a href="http://www.iatistandard.org">IATI Standard</a> as defined 
            in the <a href="http://iatistandard.org/downloads/iati-activities-schema.xsd">XML Schema</a>, the supplementary 
            <a href="http://iatistandard.org/activities-standard">IATI Standard documentation</a>, another <a href="http://iatistandard.org/standard/activities">version</a>, a guide (<a href="http://iatistandard.org/downloads/user-guide-and-tutorial.doc">doc</a>,
            <a href="http://iatistandard.org/guides/xml-schema-tutorial">html</a>) [are these all the same?] and additional compliance rules created for the purposes of creating statistically useful data.
        </div>
        <div> The 1.0 standard ruleset needs to be carefully checked to ensure that it covers the full set of conditions implied by the XML schema and the IATI standard document</div>
    </description>
    <rule id="standard-1.0:1">
        <path>/*</path>
        <assertion>count($doc/reporting-org[@ref ne ""]) eq 1</assertion>
        <description>A single Reporting Organisation</description>
    </rule>
    <rule id="standard-1.0:2">
        <path>/*</path>
        <assertion>count($doc/iati-identifier[text() ne ""]) eq 1</assertion>
        <description>A single iati-identifier</description>
    </rule>
    <rule id="standard-1.0:3">
        <path>/*</path>
        <assertion>count($doc/title[. ne ""]) ge 1 </assertion>
        <description>At least one title</description>
    </rule>
    <rule id="standard-1.0:4">
        <path>/*</path>
        <assertion>count($doc/activity-status) = 1</assertion>
        <description>A single activity-status</description>
    </rule>
    <rule id="standard-1.0:5">
        <path>/@default-currency</path>
        <codelist>Currency</codelist>
    </rule>
    <rule id="standard-1.0:6">
        <path>/@hierarchy</path>
        <type>xs:integer</type>
    </rule>
    <rule id="standard-1.0:7">
        <path>/@last-updated-datetime</path>
        <type>xs:dateTime</type>
    </rule>
    <rule id="standard-1.0:8">
        <path>/activity-date/@type</path>
        <codelist>ActivityDateType</codelist>
    </rule>
    <rule id="standard-1.0:13">
        <path>/activity-status/@code</path>
        <codelist>ActivityStatus</codelist>
    </rule>
<!--    <rule id="standard-1.0:14">
        <path>/budget/@type</path>
        <type>xs:integer</type>
        <description/>
    </rule>
    attempt at further diagnosis but thye code list check is enough 
-->
    <rule id="standard-1.0:14a">
        <path>/budget/@type</path>
        <codelist>BudgetType</codelist>
        <description/>
    </rule>
    <rule id="standard-1.0:15">
        <path>/budget/period-end</path>
        <assertion>exists($this/@iso-date)</assertion>
        <description>budget period-end has iso-date</description>
    </rule>
    <rule id="standard-1.0:16">
        <path>/budget/period-start</path>
        <assertion>exists($this/@iso-date)</assertion>
        <description>budget period-start has iso-date</description>
    </rule>
    <rule id="standard-1.0:16a">
        <path>/budget</path>
        <assertion>exists($this/period-start) and exists($this/period-end)</assertion>
        <description>budget has period-start and period-end</description>
    </rule>
    <rule id="standard-1.0:16b">
        <path>/budget</path>
        <pre>exists($this/period-start/@iso-date) and exists($this/period-end/@iso-date)</pre>
        <assertion>$this/period-start/@iso-date le $this/period-end/@iso-date</assertion>
        <description>budget period-start earlier than period-end</description>
    </rule>
    <rule id="standard-1.0:17">
        <path>/budget/value</path>
        <type>xs:integer</type>
    </rule>
    <rule id="standard-1.0:18">
        <path>/budget/value/@currency</path>
        <codelist>Currency</codelist>
    </rule>
    <rule id="standard-1.0:19">
        <path>/budget/value/@value-date</path>
        <type>xs:date</type>
    </rule>
    <rule id="standard-1.0:20">
        <path>/collaboration-type/@code</path>
        <codelist>CollaborationType</codelist>
    </rule>
    <rule id="standard-1.0:21">
        <path>/conditions/@attached</path>
        <type>xs:boolean</type>
    </rule>
    <rule id="standard-1.0:22">
        <path>/conditions/condition/@type</path>
        <codelist>ConditionType</codelist>
    </rule>
    <rule id="standard-1.0:23">
        <path>/default-aid-type/@code</path>
        <codelist>AidType</codelist>
    </rule>
    <rule id="standard-1.0:24">
        <path>/default-finance-type/@code</path>
        <codelist>FinanceType</codelist>
    </rule>
    <rule id="standard-1.0:25">
        <path>/default-flow-type/@code</path>
        <codelist>FlowType</codelist>
    </rule>
    <rule id="standard-1.0:26">
        <path>/default-tied-status/@code</path>
        <codelist>TiedStatus</codelist>
    </rule>
    <rule id="standard-1.0:27">
        <path>/description/@type</path>
        <codelist>DescriptionType</codelist>
    </rule>
    <rule id="standard-1.0:29">
        <path>/document-link/@format</path>
        <codelist>FileFormat</codelist>
    </rule>
    <rule id="standard-1.0:30">
        <path>/document-link/category/@code</path>
        <codelist>DocumentCategory</codelist>
    </rule>
    <rule id="standard-1.0:31">
        <path>/location</path>
        <assertion>exists($this/name)</assertion>
        <description>location has a name</description>
    </rule>
    <rule id="standard-1.0:32">
        <path>/location/*</path>
        <pre>count($this) gt 1</pre>
        <assertion>sum($this/@percentage[. castable as xs:integer]) = 100</assertion>
        <description>percentages of locations  sum to 100</description>
    </rule>
    <rule id="standard-1.0:33">
        <path>/location/@percentage</path>
        <type>xs:integer</type>
    </rule>
    <rule id="standard-1.0:34">
        <path>/location/administrative/@country</path>
        <codelist>Country</codelist>
    </rule>
    <rule id="standard-1.0:35">
        <path>/location/coordinates/@latitude</path>
        <type>xs:decimal</type>
    </rule>
    <rule id="standard-1.0:36">
        <path>/location/coordinates/@longitude</path>
        <type>xs:decimal</type>
    </rule>
    <rule id="standard-1.0:37">
        <path>/location/coordinates/@precision</path>
        <codelist>GeographicalPrecision</codelist>
    </rule>
    <rule id="standard-1.0:38">
        <path>/location/gazetteer-entry</path>
        <type>xs:integer</type>
    </rule>
    <rule id="standard-1.0:39">
        <path>/location/gazetteer-entry/@gazetteer-ref</path>
        <codelist>GazatteerAgencyCode</codelist>
    </rule>
    <rule id="standard-1.0:40">
        <path>/location/location-type/@code</path>
        <codelist>LocationType</codelist>
    </rule>
    <rule id="standard-1.0:41">
        <path>/other-identifier/@owner-ref</path>
        <codelist>OrganisationIdentifier</codelist>
    </rule>
    <rule id="standard-1.0:42">
        <path>/participating-org/@ref</path>
        <codelist>OrganisationIdentifier</codelist>
    </rule>
    <rule id="standard-1.0:43">
        <path>/participating-org/@role</path>
        <codelist>OrganisationRole</codelist>
    </rule>
    <rule id="standard-1.0:44">
        <path>/participating-org/@type</path>
        <codelist>OrganisationType</codelist>
    </rule>
    <rule id="standard-1.0:45">
        <path>/planned-disbursement/period-end</path>
        <assertion>exists($this/@iso-date)</assertion>
        <description>planned-disbursement period-end has an iso-date</description>
    </rule>
    <rule id="standard-1.0:46">
        <path>/planned-disbursement/period-start</path>
        <assertion>exists($this/@iso-date)</assertion>
        <description>planned-disbursement period-start has an iso-date</description>
    </rule>
    <rule id="standard-1.0:46a">
        <path>/planned-disbursement</path>
        <assertion>exists($this/period-start) and exists($this/period-end)</assertion>
        <description>planned-disbursement has period-start and period-end</description>
    </rule>
    <rule id="standard-1.0:46b">
        <path>/planned-disbursement</path>
        <pre>exists($this/period-start/@iso-date) and exists($this/period-end/@iso-date)</pre>
        <assertion>$this/period-start/@iso-date le $this/period-end/@iso-date</assertion>
        <description>planned-disbursement period-start earlier than period-end</description>
    </rule>
    <rule id="standard-1.0:47">
        <path>/planned-disbursement/value</path>
        <type>xs:integer</type>
    </rule>
    <rule id="standard-1.0:48">
        <path>/planned-disbursement/value/@currency</path>
        <codelist>Currency</codelist>
    </rule>
    <rule id="standard-1.0:49">
        <path>/planned-disbursement/value/@value-date</path>
        <type>xs:date</type>
    </rule>
    <rule id="standard-1.0:50">
        <path>/policy-marker/@code</path>
        <codelist>PolicyMarker</codelist>
    </rule>
    <rule id="standard-1.0:51">
        <path>/policy-marker/@significance</path>
        <codelist>PolicySignificance</codelist>
    </rule>
    <rule id="standard-1.0:52">
        <path>/policy-marker/@vocabulary</path>
        <codelist>Vocabulary</codelist>
    </rule>
    <rule id="standard-1.0:53">
        <path>/recipient-country/*</path>
        <pre>count($this) gt 1</pre>
        <assertion>sum($this/@percentage[. castable as xs:integer]) = 100 </assertion>
        <description>percentages of countries sum to 100</description>
    </rule>
    <rule id="standard-1.0:54">
        <path>/recipient-country/@code</path>
        <codelist>Country</codelist>
    </rule>
    <rule id="standard-1.0:55">
        <path>/recipient-country/@percentage</path>
        <type>xs:integer</type>
    </rule>
    <rule id="standard-1.0:56">
        <path>/recipient-region/*</path>
        <pre>count($this) gt 1</pre>
        <assertion>sum($this/@percentage[. castable as xs:integer]) eq 100</assertion>
        <description>percentages of regions sum to 100</description>
    </rule>
    <rule id="standard-1.0:57">
        <path>/recipient-region/@code</path>
        <codelist>Region</codelist>
    </rule>
    <rule id="standard-1.0:58">
        <path>/recipient-region/@percentage</path>
        <type>xs:integer</type>
    </rule>
    <rule id="standard-1.0:59">
        <path>/related-activity/@ref</path>
        <target>Activity/iati-identifier</target>
    </rule>
    <rule id="standard-1.0:60">
        <path>/related-activity/@type</path>
        <codelist>RelatedActivityType</codelist>
    </rule>
    <rule id="standard-1.0:61">
        <path>/reporting-org/@ref</path>
        <codelist>OrganisationIdentifier</codelist>
    </rule>
    <rule id="standard-1.0:62">
        <path>/reporting-org@type</path>
        <codelist>OrganisationType</codelist>
    </rule>
    <rule id="standard-1.0:63">
        <path>/result/@type</path>
        <codelist>ResultType</codelist>
    </rule>
    <rule id="standard-1.0:64">
        <path>/result/indicator/@measure</path>
        <codelist>IndicatorMeasure</codelist>
    </rule>
    <rule id="standard-1.0:65">
        <path>/sector/*</path>
        <assertion> every $vocabulary in distinct-values($doc/sector/@vocabulary) satisfies (if
            (count($doc/sector[@vocabulary=$vocabulary]) &gt; 1) then
            sum($doc/sector[@vocabulary=$vocabulary]/@percentage[. castable as xs:integer]) =
            100 else true()) and (if (count($doc/sector[empty(@vocabulary)]) &gt; 1) then
            sum($doc/sector[empty(@vocabulary)]/@percentage[. castable as xs:integer]) = 100
            else true()) </assertion>
        <description>percentages of sectors in every vocabulary including the default vocabulary 
            sum to 100</description>
    </rule>
    <rule id="standard-1.0:66">
        <path>/sector/@code</path>
        <pre>$this/../@vocabulary="DAC"</pre>
        <codelist>Sector</codelist>
    </rule>
    <rule id="standard-1.0:67">
        <path>/sector/@code</path>
        <pre>empty($this/../@vocabulary)</pre>
        <codelist>Sector</codelist>
    </rule>
    <rule id="standard-1.0:68">
        <path>/sector/@percentage</path>
        <type>xs:integer</type>
    </rule>
    <rule id="standard-1.0:69">
        <path>/sector/@vocabulary</path>
        <codelist>Vocabulary</codelist>
    </rule>
    <rule id="standard-1.0:70">
        <path>/transaction/aid-type/@code</path>
        <codelist>AidType</codelist>
    </rule>
    <rule id="standard-1.0:71">
        <path>/transaction/disbursement-channel/@code</path>
        <codelist>DisbursementChannel</codelist>
    </rule>
    <rule id="standard-1.0:72">
        <path>/transaction/finance-type/@code</path>
        <codelist>FinanceType</codelist>
    </rule>
    <rule id="standard-1.0:73">
        <path>/transaction/flow-type/@code</path>
        <codelist>FlowType</codelist>
    </rule>
    <rule id="standard-1.0:74">
        <path>/transaction/provider-org/@provider-activity-id</path>
        <target>Activity/iati-identifier</target>
    </rule>
    <rule id="standard-1.0:75">
        <path>/transaction/provider-org/@receiver-activity-id</path>
        <target>Activity/iati-identifier</target>
    </rule>
    <rule id="standard-1.0:76">
        <path>/transaction/provider-org/@ref</path>
        <codelist>OrganisationIdentifier</codelist>
    </rule>
    <rule id="standard-1.0:77">
        <path>/transaction/receiver-org/@ref</path>
        <codelist>OrganisationIdentifier</codelist>
    </rule>
    <rule id="standard-1.0:78">
        <path>/transaction/tied-status/@code</path>
        <codelist>TiedStatus</codelist>
    </rule>
    <rule id="standard-1.0:79">
        <path>/transaction/transaction-type/@code</path>
        <codelist>TransactionType</codelist>
    </rule>
    <rule id="standard-1.0:80">
        <path>/transaction/value</path>
        <type>xs:integer</type>
    </rule>
    <rule id="standard-1.0:81">
        <path>/transaction/value</path>
        <assertion>exists($this/@value-date)</assertion>
        <description>value-date required</description>
    </rule>
    <rule id="standard-1.0:82">
        <path>/transaction/value/@currency</path>
        <codelist>Currency</codelist>
    </rule>
    <rule id="standard-1.0:83">
        <path>/transaction/value/@value-date</path>
        <type>xs:date</type>
    </rule>
    <rule id="standard-1.0:84">
        <path>@iso-date</path>
        <type>xs:date</type>
    </rule>
    <rule id="standard-1.0:85">
        <path>@value-date</path>
        <type>xs:date</type>
    </rule>
    <rule id="standard-1.0:86">
        <path>@xml:lang</path>
        <codelist>Language</codelist>
    </rule>
    <rule id="standard-1.0:87">
        <path>/activity-website</path>
        <type>xs:anyURI</type>
    </rule>
</ruleset>